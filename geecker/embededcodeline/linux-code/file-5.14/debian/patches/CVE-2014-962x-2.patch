From 65437cee25199dbd385fb35901bc0011e164276c Mon Sep 17 00:00:00 2001
From: Christos Zoulas <christos@zoulas.com>
Date: Tue, 16 Dec 2014 23:29:42 +0000
Subject: [PATCH] Limit string printing to 100 chars, and add flags I forgot in
 the previous commit.

---
 src/readelf.c | 11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

Index: file-5.14/src/readelf.c
===================================================================
--- file-5.14.orig/src/readelf.c	2018-06-13 15:10:00.078920054 -0400
+++ file-5.14/src/readelf.c	2018-06-13 15:10:00.074920045 -0400
@@ -899,19 +899,23 @@ donote(struct magic_set *ms, void *vbuf,
 	}
 
 	if (namesz == 7 && strcmp((char *)&nbuf[noff], "NetBSD") == 0) {
+		if (descsz > 100)
+			descsz = 100;
 		switch (xnh_type) {
 	    	case NT_NETBSD_VERSION:
 			return size;
 		case NT_NETBSD_MARCH:
 			if (*flags & FLAGS_DID_NETBSD_MARCH)
 				return size;
-			if (file_printf(ms, ", compiled for: %.*s", (int)descsz,
-			    (const char *)&nbuf[doff]) == -1)
+			*flags |= FLAGS_DID_NETBSD_MARCH;
+			if (file_printf(ms, ", compiled for: %.*s",
+			    (int)descsz, (const char *)&nbuf[doff]) == -1)
 				return size;
 			break;
 		case NT_NETBSD_CMODEL:
 			if (*flags & FLAGS_DID_NETBSD_CMODEL)
 				return size;
+			*flags |= FLAGS_DID_NETBSD_CMODEL;
 			if (file_printf(ms, ", compiler model: %.*s",
 			    (int)descsz, (const char *)&nbuf[doff]) == -1)
 				return size;
@@ -919,6 +923,7 @@ donote(struct magic_set *ms, void *vbuf,
 		default:
 			if (*flags & FLAGS_DID_NETBSD_UNKNOWN)
 				return size;
+			*flags |= FLAGS_DID_NETBSD_UNKNOWN;
 			if (file_printf(ms, ", note=%u", xnh_type) == -1)
 				return size;
 			break;
