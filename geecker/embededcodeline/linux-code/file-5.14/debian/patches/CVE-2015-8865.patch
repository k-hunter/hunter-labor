From 6713ca45e7757297381f4b4cdb9cf5e624a9ad36 Mon Sep 17 00:00:00 2001
From: Christos Zoulas <christos@zoulas.com>
Date: Wed, 3 Jun 2015 18:01:20 +0000
Subject: [PATCH] PR/454: Fix memory corruption when the continuation level
 jumps by more than 20 in a single step.

---
 src/funcs.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

Index: file-5.14/src/funcs.c
===================================================================
--- file-5.14.orig/src/funcs.c	2018-06-13 14:45:19.228906193 -0400
+++ file-5.14/src/funcs.c	2018-06-13 14:45:19.228906193 -0400
@@ -410,7 +410,7 @@ file_check_mem(struct magic_set *ms, uns
 	size_t len;
 
 	if (level >= ms->c.len) {
-		len = (ms->c.len += 20) * sizeof(*ms->c.li);
+		len = (ms->c.len = 20 + level) * sizeof(*ms->c.li);
 		ms->c.li = CAST(struct level_info *, (ms->c.li == NULL) ?
 		    malloc(len) :
 		    realloc(ms->c.li, len));
