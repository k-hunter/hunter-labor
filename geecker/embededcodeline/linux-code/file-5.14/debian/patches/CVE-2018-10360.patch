From a642587a9c9e2dd7feacdf513c3643ce26ad3c22 Mon Sep 17 00:00:00 2001
From: Christos Zoulas <christos@zoulas.com>
Date: Sat, 9 Jun 2018 16:00:06 +0000
Subject: [PATCH] Avoid reading past the end of buffer (Rui Reis)

---
 src/readelf.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

Index: file-5.14/src/readelf.c
===================================================================
--- file-5.14.orig/src/readelf.c	2018-06-13 15:10:03.958928230 -0400
+++ file-5.14/src/readelf.c	2018-06-13 15:10:03.958928230 -0400
@@ -787,7 +787,8 @@ do_core_note(struct magic_set *ms, unsig
 
 				cname = (unsigned char *)
 				    &nbuf[doff + prpsoffsets(i)];
-				for (cp = cname; *cp && isprint(*cp); cp++)
+				for (cp = cname; cp < nbuf + size && *cp
+				    && isprint(*cp); cp++)
 					continue;
 				/*
 				 * Linux apparently appends a space at the end
